<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="x5-fullscreen" content="true">
<meta name="full-screen" content="yes">
<meta name="theme-color" content="#317EFB" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=0" name="viewport">
<meta name="description" content="C++大型流媒体项目1. 安装配置Centos71.1 下载镜像虚拟机安装系统1https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;centos&#x2F;7&#x2F;isos&#x2F;x86_64&#x2F;CentOS-7-x86_64-DVD-2009.iso  1.2 更改yum源下载文件 1http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo  文件内容 123456789101112">
<meta property="og:type" content="article">
<meta property="og:title" content="C++大型流媒体项目">
<meta property="og:url" content="http://example.com/2024/11/16/C++%E5%A4%A7%E5%9E%8B%E6%B5%81%E5%AA%92%E4%BD%93%E9%A1%B9%E7%9B%AE/index.html">
<meta property="og:site_name" content="JarryLi&#39;s Blog">
<meta property="og:description" content="C++大型流媒体项目1. 安装配置Centos71.1 下载镜像虚拟机安装系统1https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;centos&#x2F;7&#x2F;isos&#x2F;x86_64&#x2F;CentOS-7-x86_64-DVD-2009.iso  1.2 更改yum源下载文件 1http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo  文件内容 123456789101112">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="article:published_time" content="2024-11-16T09:07:36.698Z">
<meta property="article:modified_time" content="2024-11-24T14:02:11.094Z">
<meta property="article:author" content="JarryLi">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/404.jpg">


<title >C++大型流媒体项目</title>

<!-- Favicon -->

    <link href='/img/favicon.svg?v=2.2.2' rel='icon' type='image/png' sizes='16x16' ></link>


    <link href='/img/favicon.svg?v=2.2.2' rel='icon' type='image/png' sizes='32x32' ></link>




<!-- Plugin -->




    
<link rel="stylesheet" href="/css/plugins/bootstrap.row.css">

    
<link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui@4.0/dist/fancybox.css">

    
    




<!-- Icon -->

    
<link rel="stylesheet" href="/css/plugins/font-awesome.min.css">




<!-- Variable -->
<script>window.ASYNC_CONFIG = {"hostname":"example.com","author":"JarryLi","root":"/","typed_text":null,"theme_version":"2.2.2","theme":{"switch":true,"default":"style-light"},"favicon":{"logo":"/img/favicon.svg","icon16":"/img/favicon.svg","icon32":"/img/favicon.svg","apple_touch_icon":null,"webmanifest":null,"visibilitychange":false,"hidden":"/failure.ico","show_text":"(/≧▽≦/)Hey! Good again!","hide_text":"(●—●)Oh, crash!"},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms","author":"Post author: ","copyright_link":"Post link: ","copyright_license_title":"Copyright Notice: ","copyright_license_content":"All articles in this blog are licensed under undefined unless otherwise stated.","copy_success":"Copied","copy_failure":"Copy failed","open_read_mode":"Enter reading mode","exit_read_mode":"Exit reading mode","notice_outdate_message":"It has been undefined days since the last update, the content of the article may be outdated.","sticky":"TOP","just":"Just","min":"minutes ago","hour":"hours ago","day":"days ago","month":"months ago"},"swup":false,"plugin":{"flickr_justified_gallery":"https://unpkg.com/flickr-justified-gallery@latest/dist/fjGallery.min.js"},"icons":{"sun":"far fa-sun","moon":"far fa-moon","play":"fas fa-play","email":"far fa-envelope","next":"fas fa-arrow-right","calendar":"far fa-calendar-alt","clock":"far fa-clock","user":"far fa-user","back_top":"fas fa-arrow-up","close":"fas fa-times","search":"fas fa-search","reward":"fas fa-hand-holding-usd","user_tag":"fas fa-user-alt","toc_tag":"fas fa-th-list","read":"fas fa-book-reader","arrows":"fas fa-arrows-alt-h","double_arrows":"fas fa-angle-double-down","copy":"fas fa-copy"},"icontype":"font","highlight":{"plugin":"highlighjs","theme":true,"copy":true,"lang":true,"title":"default","height_limit":false},"toc":{"post_title":true},"live_time":{"start_time":"01/01/2024 00:00:00","prefix":"The blog has been lovely to run undefined day"},"danmu":{"enable":false,"el":".trm-banner"},"search":{"enable":true,"type":"local","trigger":"auto","path":"search.xml"}};</script>
<script id="async-page-config">window.PAGE_CONFIG = {"isPost":true,"isHome":false,"postUpdate":"2024-11-24 22:02:11"};</script>

<!-- Theme mode css -->
<link data-swup-theme rel="stylesheet" href="/css/index.css?v=2.2.2" id="trm-switch-style">
<script>
    let defaultMode = ASYNC_CONFIG.theme.default !=='auto' ?  ASYNC_CONFIG.theme.default : (window.matchMedia("(prefers-color-scheme: light)").matches ? 'style-light' : 'style-dark')
    let catchMode = localStorage.getItem('theme-mode') || defaultMode;
    let type = catchMode === 'style-dark' ? 'add' : 'remove';
    document.documentElement.classList[type]('dark')
</script>

<!-- CDN -->


    
    



<!-- Site Analytics -->

 
<meta name="generator" content="Hexo 7.3.0"></head>

<body>

  <!-- app wrapper -->
  <div class="trm-app-frame">

    <!-- page preloader -->
    <div class="trm-preloader">
    <div class="trm-holder">
        <div class="preloader">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
</div>
    <!-- page preloader end -->

    <!-- change mode preloader -->
    <div class="trm-mode-swich-animation-frame">
    <div class="trm-mode-swich-animation">
        <i class="i-sun"><i class="iconfont far fa-sun"></i></i>
        <div class="trm-horizon"></div>
        <i class="i-moon"><i class="iconfont far fa-moon"></i></i>
    </div>
</div>
    <!-- change mode preloader end -->

      <!-- scroll container -->
      <div id="trm-dynamic-content" class="trm-swup-animation">
        <div id="trm-scroll-container" class="trm-scroll-container" style="opacity: 0">
            <!-- top bar -->
            <header class="trm-top-bar">
	<div class="container">
		<div class="trm-left-side">
			<!-- logo -->
<!-- <a href="/" class="trm-logo-frame trm-anima-link">
    
        <img alt="logo" src="/img/favicon.svg">
    
    
        <div class="trm-logo-text">
            Async<span>Theme</span>
        </div>
    
</a> -->
<!-- logo end -->
		</div>
		<div class="trm-right-side">
			<!-- menu -->
<div class="trm-menu">
    <nav>
        <ul>
            
            <li class="menu-item-has-children ">
                <a  href="/" target="">
                    Home
                </a>
                
            </li>
            
            <li class="menu-item-has-children ">
                <a  href="/archives/" target="">
                    Archives
                </a>
                
            </li>
            
        </ul>
    </nav>
</div>
<!-- menu end -->
			
    <!-- mode switcher place -->
    <div class="trm-mode-switcher-place">
        <div class="trm-mode-switcher">
            <i class="iconfont far fa-sun"></i>
            <input class="tgl tgl-light" id="trm-swich" type="checkbox">
            <label class="trm-swich" for="trm-swich"></label>
            <i class="iconfont far fa-moon"></i>
        </div>
    </div>
    <!-- mode switcher place end -->

			
    
    <div id="trm-search-btn" class="trm-search-btn">
        <i class="iconfont fas fa-search"></i>
    </div>
     

		</div>
		<div class="trm-menu-btn">
			<span></span>
		</div>
	</div>
</header>
            <!-- top bar end -->

            <!-- body -->
            
<div class="trm-content-start">
    <!-- banner -->
    <div class="trm-banner">
    
    <!-- banner cover -->
    <img style="object-position:top;object-fit:cover;" alt="banner" class="trm-banner-cover" src="/img/banner.png">
    <!-- banner cover end -->
    

    <!-- banner content -->
    <div class="trm-banner-content trm-overlay">
        <div class="container">
            <div class="row">
                
                <div class="col-lg-4"></div>
                
                <div class="col-lg-8">

                    <!-- banner title -->
                    <div class="trm-banner-text ">
                        <div class="trm-label trm-mb-20">
                            NEWS LETTER
                        </div>
                        <h1 class="trm-mb-30 trm-hsmb-font">
                            C++大型流媒体项目
                        </h1>

                        
                            <ul class="trm-breadcrumbs trm-label">
                                <li>
                                    <a href="/" class="trm-anima-link">Home</a>
                                </li>
                                <li>
                                    <span>
                                        2024
                                    </span>
                                </li>
                            </ul>
                        
                    </div>
                    <!-- banner title end -->

                    <!-- scroll hint -->
                    <span id="scroll-triger" class="trm-scroll-hint-frame">
                        <div class="trm-scroll-hint"></div>
                        <span class="trm-label">Scroll down</span>
                    </span>
                    <!-- scroll hint end -->

                </div>
            </div>
        </div>
    </div>
    <!-- banner content end -->
</div>
    <!-- banner end -->
    <div class="container">
        <div class="row">
            
                <div class="trm-page-sidebar col-lg-4 hidden-sm">
                    <!-- main card -->
                    <div class="trm-main-card-frame trm-sidebar">
    <div class="trm-main-card"> 
        <!-- card header -->
<div class="trm-mc-header">
    <div class="trm-avatar-frame trm-mb-20">
        <img alt="Avatar" class="trm-avatar" src="/img/avatar.jpg">
    </div>
    <h5 class="trm-name trm-mb-15">
        JarryLi
    </h5>
    
</div>
<!-- card header end -->
        <!-- sidebar social -->

<div class="trm-divider trm-mb-40 trm-mt-40"></div>
<div class="trm-social">
    
        <a href="https://github.com/jarryLi-max" title="Github" rel="nofollow" target="_blank">
            <i class="iconfont fab fa-github"></i>
        </a>
    
</div>

<!-- sidebar social end -->
        <!-- info -->
<div class="trm-divider trm-mb-40 trm-mt-40"></div>
<ul class="trm-table trm-mb-20">
    
        <li>
            <div class="trm-label">
                Residence:
            </div>
            <div class="trm-label trm-label-light">
                China
            </div>
        </li>
        <li>
            <div class="trm-label">
                email:
            </div>
            <div class="trm-label trm-label-light">
                2976562002@qq.com
            </div>
        </li>
    
</ul>
<!-- info end -->

        
    </div>
</div>
                    <!-- main card end -->
                </div>
            
            <div class="trm-page-content col-lg-8">
                <div id="trm-content" class="trm-content">
                    <div class="trm-post-info row hidden-sm">
    <div class="col-sm-4">
        <div class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-calendar-alt trm-icon"></i><br>
            11/16
        </div>
    </div>
    <div class="col-sm-4">
        <div class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-clock trm-icon"></i><br>
            17:07
        </div>
    </div>
    <div class="col-sm-4">
        <div id="post-author" class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-user trm-icon"></i><br>
            JarryLi
        </div>
    </div>
</div>
<div class="trm-card ">
    <article id="article-container" class="trm-publication">
    <h1 id="C-大型流媒体项目"><a href="#C-大型流媒体项目" class="headerlink" title="C++大型流媒体项目"></a>C++大型流媒体项目</h1><h2 id="1-安装配置Centos7"><a href="#1-安装配置Centos7" class="headerlink" title="1. 安装配置Centos7"></a>1. 安装配置Centos7</h2><h3 id="1-1-下载镜像虚拟机安装系统"><a href="#1-1-下载镜像虚拟机安装系统" class="headerlink" title="1.1 下载镜像虚拟机安装系统"></a>1.1 下载镜像虚拟机安装系统</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.aliyun.com/centos/7/isos/x86_64/CentOS-7-x86_64-DVD-2009.iso</span><br></pre></td></tr></table></figure>

<h3 id="1-2-更改yum源"><a href="#1-2-更改yum源" class="headerlink" title="1.2 更改yum源"></a>1.2 更改yum源</h3><p>下载文件</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure>

<p>文件内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"># CentOS-Base.repo</span><br><span class="line">#</span><br><span class="line"># The mirror system uses the connecting IP address of the client and the</span><br><span class="line"># update status of each mirror to pick mirrors that are updated to and</span><br><span class="line"># geographically close to the client.  You should use this for CentOS updates</span><br><span class="line"># unless you are manually picking other mirrors.</span><br><span class="line">#</span><br><span class="line"># If the mirrorlist= does not work for you, as a fall back you can try the </span><br><span class="line"># remarked out baseurl= line instead.</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line"> </span><br><span class="line">[base]</span><br><span class="line">name=CentOS-$releasever - Base - mirrors.aliyun.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos/$releasever/os/$basearch/</span><br><span class="line">        http://mirrors.aliyuncs.com/centos/$releasever/os/$basearch/</span><br><span class="line">        http://mirrors.cloud.aliyuncs.com/centos/$releasever/os/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"> </span><br><span class="line">#released updates </span><br><span class="line">[updates]</span><br><span class="line">name=CentOS-$releasever - Updates - mirrors.aliyun.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos/$releasever/updates/$basearch/</span><br><span class="line">        http://mirrors.aliyuncs.com/centos/$releasever/updates/$basearch/</span><br><span class="line">        http://mirrors.cloud.aliyuncs.com/centos/$releasever/updates/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"> </span><br><span class="line">#additional packages that may be useful</span><br><span class="line">[extras]</span><br><span class="line">name=CentOS-$releasever - Extras - mirrors.aliyun.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos/$releasever/extras/$basearch/</span><br><span class="line">        http://mirrors.aliyuncs.com/centos/$releasever/extras/$basearch/</span><br><span class="line">        http://mirrors.cloud.aliyuncs.com/centos/$releasever/extras/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"> </span><br><span class="line">#additional packages that extend functionality of existing packages</span><br><span class="line">[centosplus]</span><br><span class="line">name=CentOS-$releasever - Plus - mirrors.aliyun.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos/$releasever/centosplus/$basearch/</span><br><span class="line">        http://mirrors.aliyuncs.com/centos/$releasever/centosplus/$basearch/</span><br><span class="line">        http://mirrors.cloud.aliyuncs.com/centos/$releasever/centosplus/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"> </span><br><span class="line">#contrib - packages by Centos Users</span><br><span class="line">[contrib]</span><br><span class="line">name=CentOS-$releasever - Contrib - mirrors.aliyun.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos/$releasever/contrib/$basearch/</span><br><span class="line">        http://mirrors.aliyuncs.com/centos/$releasever/contrib/$basearch/</span><br><span class="line">        http://mirrors.cloud.aliyuncs.com/centos/$releasever/contrib/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure>

<p>执行下列操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak # 备份初始文件</span><br><span class="line"></span><br><span class="line">vi /etc/yum.repos.d/CentOS-Base.repo # 编辑文件</span><br><span class="line"></span><br><span class="line">sudo yum makecache # 更换阿里源</span><br></pre></td></tr></table></figure>

<p>更换成功</p>
<p><img src="D:\Develop\Blog\source_posts\assets\image-20241116164919701.png" alt="image-20241116164919701"  data-tag='post-image' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<h3 id="1-3-安装必要环境"><a href="#1-3-安装必要环境" class="headerlink" title="1.3 安装必要环境"></a>1.3 安装必要环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc</span><br><span class="line">yum install gcc-g++</span><br><span class="line">yum install cmake</span><br></pre></td></tr></table></figure>

<h3 id="1-4-VSCode远程通过SSH连接Linux"><a href="#1-4-VSCode远程通过SSH连接Linux" class="headerlink" title="1.4 VSCode远程通过SSH连接Linux"></a>1.4 VSCode远程通过SSH连接Linux</h3><p><img src="D:\Develop\Blog\source_posts\assets\image-20241117092108240.png" alt="image-20241117092108240"  data-tag='post-image' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<h2 id="2-创建工程项目文件夹"><a href="#2-创建工程项目文件夹" class="headerlink" title="2. 创建工程项目文件夹"></a>2. 创建工程项目文件夹</h2><h3 id="2-1-创建tmms文件夹"><a href="#2-1-创建tmms文件夹" class="headerlink" title="2.1 创建tmms文件夹"></a>2.1 创建tmms文件夹</h3><h3 id="2-2-依次创建下列文件夹和文件"><a href="#2-2-依次创建下列文件夹和文件" class="headerlink" title="2.2 依次创建下列文件夹和文件"></a>2.2 依次创建下列文件夹和文件</h3><p><img src="D:\Develop\Blog\source_posts\assets\image-20241117150312903.png" alt="image-20241117150312903"  data-tag='post-image' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 上面CMakeList.txt 前面写1的内容</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. SRCS)</span><br><span class="line"><span class="keyword">add_executable</span>(tmms <span class="variable">$&#123;SRCS&#125;</span>)</span><br><span class="line"><span class="keyword">install</span>(TARGETS tmms RUNTIME DESTINATION sbin)</span><br></pre></td></tr></table></figure>

<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2. 上面CMakeList.txt 前面写2的内容</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">add_subdirectory</span>(main)</span><br></pre></td></tr></table></figure>

<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3. 上面CMakeList.txt 前面写3的内容</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">2.6</span>)</span><br><span class="line"> <span class="keyword">project</span>(tmms)</span><br><span class="line"> <span class="keyword">set</span>(CMAKE_INSTALL_PREFIX ../bin)</span><br><span class="line"> <span class="keyword">if</span> (CMAKE_BUILD_TYPE <span class="keyword">STREQUAL</span> Debug)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11 -O0 -g -pipe -Wall -Werror -Wno-unused-variable -lrt -pthread&quot;</span>)</span><br><span class="line"> <span class="keyword">elseif</span> (<span class="keyword">NOT</span> CMAKE_BUILD_TYPE <span class="keyword">STREQUAL</span> Debug)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;Release Version.&quot;</span>)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11 -O3 -g -pipe -Wall -Werror -Wno-unused-variable -lrt -pthread&quot;</span>)</span><br><span class="line"> <span class="keyword">endif</span> ()</span><br><span class="line"> <span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; -fno-strict-aliasing -Wno-error=shadow -Wno-sign-compare&quot;</span>)</span><br><span class="line"> <span class="keyword">message</span>(STATUS <span class="string">&quot;USING GCC VERSION: $&#123;CMAKE_CXX_COMPILER_VERSION&#125;&quot;</span>)</span><br><span class="line"> <span class="keyword">if</span>(CMAKE_CXX_COMPILER_VERSION <span class="keyword">VERSION_GREATER</span> <span class="number">7.2</span>.<span class="number">9</span>)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;GCC Version &gt; 7.3.0, USING -Wno-error=unused-result -Werror=return-type&quot;</span>)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;-Wno-error=unused-result -Werror=return-type $&#123;CMAKE_CXX_FLAGS&#125;&quot;</span>)</span><br><span class="line"> <span class="keyword">endif</span>()</span><br><span class="line"> <span class="keyword">include_directories</span>(src)</span><br><span class="line"> <span class="keyword">add_subdirectory</span>(src)</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd build</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">编译成功，即可执行</span><br></pre></td></tr></table></figure>

<h2 id="3-C-通用基础函数库实现"><a href="#3-C-通用基础函数库实现" class="headerlink" title="3.  C++通用基础函数库实现"></a>3.  C++通用基础函数库实现</h2><p><strong>修改src&#x2F;base下的CMakeLists.txt</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 收集所有源文件</span><br><span class="line"><span class="built_in">aux_source_directory</span>(. DIR_LIB_SRCS)</span><br><span class="line"></span><br><span class="line"># 创建静态库 (排除包含 main 函数的文件)</span><br><span class="line"><span class="built_in">set</span>(TEST_FILE <span class="string">&quot;&quot;</span>)</span><br><span class="line">foreach(FILE $&#123;DIR_LIB_SRCS&#125;)</span><br><span class="line">    # 检查文件中是否包含 main 函数</span><br><span class="line">    <span class="built_in">file</span>(READ $&#123;FILE&#125; FILE_CONTENTS)</span><br><span class="line">    <span class="keyword">if</span> (FILE_CONTENTS MATCHES <span class="string">&quot;int[ ]+main[ ]*\\(&quot;</span>)</span><br><span class="line">        <span class="built_in">set</span>(TEST_FILE $&#123;FILE&#125;)</span><br><span class="line">        <span class="built_in">list</span>(REMOVE_ITEM DIR_LIB_SRCS $&#123;FILE&#125;) # 从库源文件列表中移除</span><br><span class="line">        <span class="built_in">break</span>()</span><br><span class="line">    <span class="built_in">endif</span>()</span><br><span class="line"><span class="built_in">endforeach</span>()</span><br><span class="line"></span><br><span class="line"># 如果找到 main 函数对应的文件，生成可执行文件</span><br><span class="line"><span class="keyword">if</span> (TEST_FILE)</span><br><span class="line">    <span class="built_in">message</span>(STATUS <span class="string">&quot;Main function found in: $&#123;TEST_FILE&#125;&quot;</span>)</span><br><span class="line">    <span class="built_in">add_executable</span>(base_test $&#123;TEST_FILE&#125;)</span><br><span class="line">    <span class="built_in">target_link_libraries</span>(base_test base)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">    <span class="built_in">message</span>(WARNING <span class="string">&quot;No file with main function found.&quot;</span>)</span><br><span class="line"><span class="built_in">endif</span>()</span><br><span class="line"></span><br><span class="line"># 创建库</span><br><span class="line"><span class="built_in">add_library</span>(base $&#123;DIR_LIB_SRCS&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="3-1-时间常用函数"><a href="#3-1-时间常用函数" class="headerlink" title="3.1 时间常用函数"></a>3.1 时间常用函数</h3><p><strong>声明：</strong></p>
<blockquote>
<p>TTime.h</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __TTIME_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __TTIME_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdint&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> tmms</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">namespace</span> base</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">TTime</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">            <span class="comment">// 当前的UTC时间，单位是毫秒</span></span><br><span class="line">            <span class="function"><span class="type">static</span> <span class="type">int64_t</span> <span class="title">NowMS</span><span class="params">()</span></span>;</span><br><span class="line">            <span class="comment">// 当前的UTC时间，单位是秒</span></span><br><span class="line">            <span class="function"><span class="type">static</span> <span class="type">int64_t</span> <span class="title">Now</span><span class="params">()</span></span>;</span><br><span class="line">            <span class="comment">// 当前时间，返回当前的年月日时分秒</span></span><br><span class="line">            <span class="function"><span class="type">static</span> <span class="type">int64_t</span> <span class="title">Now</span><span class="params">(<span class="type">int</span>&amp; year, <span class="type">int</span>&amp; month, <span class="type">int</span>&amp; day, <span class="type">int</span>&amp; hour, <span class="type">int</span>&amp; minute, <span class="type">int</span>&amp; second)</span></span>;</span><br><span class="line">            <span class="comment">// 返回当前时间ISO格式的字符串(yyyy-MM-ddTHH:mm:ss)            </span></span><br><span class="line">            <span class="function"><span class="type">static</span> std::string <span class="title">ISOTime</span><span class="params">()</span></span>;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// !__TTIME_H__</span></span></span><br></pre></td></tr></table></figure>

<p><strong>实现：</strong></p>
<blockquote>
<p>TTime.cpp</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TTime.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> tmms::base;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int64_t</span> <span class="title">TTime::NowMS</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// struct timeval</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">// __time_t tv_sec;        /* Seconds. */</span></span><br><span class="line">    <span class="comment">// __suseconds_t tv_usec;  /* Microseconds. */</span></span><br><span class="line">    <span class="comment">// &#125;;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">timeval</span> tv;</span><br><span class="line">    <span class="built_in">gettimeofday</span>(&amp;tv, <span class="literal">NULL</span>); <span class="comment">// 获得当前精确时间（1970年1月1日到现在的时间）</span></span><br><span class="line">    <span class="keyword">return</span> tv.tv_sec * <span class="number">1000</span> + tv.tv_usec / <span class="number">1000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int64_t</span> <span class="title">TTime::Now</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">timeval</span> tv;</span><br><span class="line">    <span class="built_in">gettimeofday</span>(&amp;tv, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">return</span> tv.tv_sec;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int64_t</span> <span class="title">TTime::Now</span><span class="params">(<span class="type">int</span>&amp; year, <span class="type">int</span>&amp; month, <span class="type">int</span>&amp; day, <span class="type">int</span>&amp; hour, <span class="type">int</span>&amp; minute, <span class="type">int</span>&amp; second)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">tm</span> tm;</span><br><span class="line">    <span class="type">time_t</span> t = <span class="built_in">time</span>(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">localtime_r</span>(&amp;t, &amp;tm); <span class="comment">// 把时间转换为本地时间</span></span><br><span class="line">    year = tm.tm_year + <span class="number">1900</span>;</span><br><span class="line">    month = tm.tm_mon + <span class="number">1</span>;</span><br><span class="line">    day = tm.tm_mday;</span><br><span class="line">    hour = tm.tm_hour;</span><br><span class="line">    minute = tm.tm_min;</span><br><span class="line">    second = tm.tm_sec;</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">TTime::ISOTime</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">timeval</span> tv;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">tm</span> tm;</span><br><span class="line">    <span class="built_in">gettimeofday</span>(&amp;tv, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="type">time_t</span> t = <span class="built_in">time</span>(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">localtime_r</span>(&amp;t, &amp;tm);</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">128</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">auto</span> n = <span class="built_in">sprintf</span>(buf, <span class="string">&quot;%4d-%02d-%02dT%02d:%02d:%02d&quot;</span>,</span><br><span class="line">                    tm.tm_year + <span class="number">1900</span>,tm.tm_mon + <span class="number">1</span>, tm.tm_mday, tm.tm_hour, tm.tm_min, tm.tm_sec);</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">string</span>(buf, buf + n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-1-1-函数简介"><a href="#3-1-1-函数简介" class="headerlink" title="3.1.1 函数简介"></a>3.1.1 函数简介</h4><p><strong>① struct timeval:</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">timeval</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">__time_t</span> tv_sec;        <span class="comment">/* Seconds. 秒数 */</span></span><br><span class="line">	<span class="type">__suseconds_t</span> tv_usec;  <span class="comment">/* Microseconds. 微秒数 */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>② struct tm:</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">tm</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> tm_sec; <span class="comment">// 秒，范围从0到59</span></span><br><span class="line">    <span class="type">int</span> tm_min; <span class="comment">// 分，范围从0到59</span></span><br><span class="line">    <span class="type">int</span> tm_hour; <span class="comment">// 小时，范围从0到23</span></span><br><span class="line">    <span class="type">int</span> tm_mday; <span class="comment">// 一个月中的日期，范围从1到31</span></span><br><span class="line">    <span class="type">int</span> tm_mon; <span class="comment">// 月份，范围从0到11（0表示一月）</span></span><br><span class="line">    <span class="type">int</span> tm_year; <span class="comment">// 年份，其值等于实际年份减去1900</span></span><br><span class="line">    <span class="type">int</span> tm_wday; <span class="comment">// 星期，范围从0到6（0表示星期天）</span></span><br><span class="line">    <span class="type">int</span> tm_yday; <span class="comment">// 一年中的第几天，范围从0到365</span></span><br><span class="line">    <span class="type">int</span> tm_isdst; <span class="comment">// 夏令时标识符</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>③ 获取当前系统时间 localtime:</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">tm</span> *<span class="built_in">localtime</span>(<span class="type">const</span> <span class="type">time_t</span> *timep);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">tm</span> *<span class="built_in">localtime_r</span>(<span class="type">const</span> <span class="type">time_t</span> *timep, <span class="keyword">struct</span> tm *result);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>localtime 是不可重入函数，线程不安全的；</p>
<p>localtime_r 是可重入函数，线程安全的。</p>
</blockquote>
<p><strong>④ time函数:</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="comment">// time()函数的返回值是从1970年1月1日至今所经历的时间(以秒为单位)</span></span><br><span class="line"><span class="type">time_t</span> current_time;  </span><br><span class="line">current_time = <span class="built_in">time</span>(<span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure>

<p><strong>⑤ 获取时间、设置时间函数</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gettimeofday</span><span class="params">(<span class="keyword">struct</span> timeval *tv, <span class="keyword">struct</span> timezone *tz)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">settimeofday</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> timeval *tv, <span class="type">const</span> <span class="keyword">struct</span> timezone *tz)</span></span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>gettimeofday: 这个函数提供了比标准的 <em>clock()</em> 函数更精确的时间测量方法，特别是在多线程环境中；</p>
<p>settimeofday: 把目前的时间用tv 结构体返回，当地时区的信息则放到tz所指的结构中。</p>
</blockquote>
<p><strong>⑥ C++11 中使用 std::chrono 获取时间</strong></p>
<p>C++11中引入了 <chrono> 库，这个库提供了一个强大的、类型安全的方式来处理时间和日期。与传统的 <code>time_t</code> 或 <code>gettimeofday</code> 等方式不同，<code>std::chrono</code> 允许你在不同的时间单位（秒、毫秒、微秒等）之间进行转换，并且能处理高精度的时间操作。</p>
<blockquote>
<p><strong><code>std::chrono</code> 提供了几个重要的组成部分：</strong></p>
<ul>
<li>时钟（Clock）：表示获取时间的机制。最常用的是 system_clock 和 steady_clock。</li>
<li>时间点（TimePoint）：表示某一时刻，通常与一个时钟一起使用。</li>
<li>持续时间（Duration）：表示时间间隔或持续时间。它是一个模板类，接受两个参数：表示时间单位的类型（如 seconds、milliseconds）和单位的大小（如 long）。</li>
</ul>
</blockquote>
<blockquote>
<h3 id="std-chrono-中的常用组件"><a href="#std-chrono-中的常用组件" class="headerlink" title="std::chrono 中的常用组件"></a><code>std::chrono</code> 中的常用组件</h3><ul>
<li><p><strong>时钟（Clock）</strong>：</p>
<ul>
<li><code>system_clock</code>：表示系统时钟，通常与世界时间同步（即 UTC 时间），可以用来获取当前时间。</li>
<li><code>steady_clock</code>：表示一个单调递增的时钟，它不受系统时间调整的影响，适用于测量经过的时间。</li>
<li><code>high_resolution_clock</code>：通常是 <code>steady_clock</code> 的别名，但在某些平台上，它可能具有更高的分辨率。</li>
</ul>
</li>
<li><p><strong>持续时间（Duration）</strong>：</p>
<ul>
<li><code>std::chrono::seconds</code>：表示秒。</li>
<li><code>std::chrono::milliseconds</code>：表示毫秒。</li>
<li><code>std::chrono::microseconds</code>：表示微秒。</li>
<li><code>std::chrono::nanoseconds</code>：表示纳秒。</li>
</ul>
</li>
<li><p><strong>时间点（TimePoint）</strong>：</p>
<ul>
<li>一个时刻，由某个时钟的当前时间表示。通过 <code>std::chrono::time_point&lt;Clock&gt;</code> 表示。</li>
</ul>
</li>
</ul>
</blockquote>
<blockquote>
<p><strong>重要的函数:</strong></p>
<ul>
<li>**<code>std::chrono::duration_cast</code>**：用来将一个时间间隔从一种单位转换为另一种单位。</li>
<li>**<code>std::chrono::time_point::time_since_epoch</code>**：获取时间点距离某个“纪元”的持续时间。</li>
<li>**<code>std::this_thread::sleep_for</code>**：使当前线程休眠指定的持续时间。</li>
<li>**<code>std::this_thread::sleep_until</code>**：使当前线程休眠直到指定的时间点。</li>
</ul>
</blockquote>
<p><strong>Example1: 获取当前时间</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 获取当前时间</span></span><br><span class="line">    <span class="keyword">auto</span> now = std::chrono::system_clock::<span class="built_in">now</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> duration = now.<span class="built_in">time_since_epoch</span>();</span><br><span class="line">    <span class="keyword">auto</span> seconds = std::chrono::<span class="built_in">duration_cast</span>&lt;std::chrono::seconds&gt;(duration).<span class="built_in">count</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Current time in seconds since epoch: &quot;</span> &lt;&lt; seconds &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注: <font color = red><code>epoch</code> 通常指的是 <strong>1970年1月1日 00:00:00 UTC</strong>，也就是 <code>Unix</code> 时间戳的起始时间。</font></p>
<p><font color = red><code>std::chrono::duration_cast</code> 用于将一种时间单位转换为另一种时间单位。</font>它通常用于精确地调整时间单位，或者将较大范围的时间（如秒）转换为较小单位（如毫秒或微秒）。需要注意的是，<code>duration_cast</code> 在转换过程中会发生 <strong>截断</strong>，即会丢失精度。它并不会进行四舍五入，而是直接去掉小数部分。</p>
<p><strong>Example2: 获取高精度时间(纳秒)</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 获取当前的系统时间(高精度)</span></span><br><span class="line">    <span class="keyword">auto</span> now = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取当前时间的纳秒级时间戳</span></span><br><span class="line">    <span class="keyword">auto</span> duration = now.<span class="built_in">time_since_epoch</span>();</span><br><span class="line">    <span class="keyword">auto</span> nanosecnods = std::chrono::<span class="built_in">duration_cast</span>&lt;std::chrono::nanoseconds&gt;(duration).<span class="built_in">count</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Current time in nanoseconds since epoch: &quot;</span> &lt;&lt; nanosecnods &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Example3: 测量代码执行时间:</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> start = std::chrono::steady_clock::<span class="built_in">now</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模拟工作</span></span><br><span class="line">    std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> end = std::chrono::steady_clock::<span class="built_in">now</span>();</span><br><span class="line">    <span class="keyword">auto</span> duration = std::chrono::<span class="built_in">duration_cast</span>&lt;std::chrono::seconds&gt;(end - start);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Elapsed time: &quot;</span> &lt;&lt; duration.<span class="built_in">count</span>() &lt;&lt; <span class="string">&quot; seconds&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Example4: 不同时间单位转换:</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 定义一个持续时间，单位为毫秒</span></span><br><span class="line">    std::<span class="function">chrono::milliseconds <span class="title">ms</span><span class="params">(<span class="number">1500</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 转换为秒</span></span><br><span class="line">    std::chrono::seconds sec = std::chrono::<span class="built_in">duration_cast</span>&lt;std::chrono::seconds&gt;(ms);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Milliseconds: &quot;</span> &lt;&lt; ms.<span class="built_in">count</span>() &lt;&lt; <span class="string">&quot; ms&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Seconds: &quot;</span> &lt;&lt; sec.<span class="built_in">count</span>() &lt;&lt; <span class="string">&quot; s&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Example5: 计时器:</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 获取开始时间</span></span><br><span class="line">    <span class="keyword">auto</span> start = std::chrono::steady_clock::<span class="built_in">now</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 模拟一些延迟</span></span><br><span class="line">    std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">1234</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取结束时间</span></span><br><span class="line">    <span class="keyword">auto</span> end = std::chrono::steady_clock::<span class="built_in">now</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 计算经过的时间</span></span><br><span class="line">    <span class="keyword">auto</span> duration = end - start;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将时间转换为不同的单位并打印</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Elapsed time in milliseconds: &quot;</span> </span><br><span class="line">              &lt;&lt; std::chrono::<span class="built_in">duration_cast</span>&lt;std::chrono::milliseconds&gt;(duration).<span class="built_in">count</span>() &lt;&lt; <span class="string">&quot; ms&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Elapsed time in seconds: &quot;</span> </span><br><span class="line">              &lt;&lt; std::chrono::<span class="built_in">duration_cast</span>&lt;std::chrono::seconds&gt;(duration).<span class="built_in">count</span>() &lt;&lt; <span class="string">&quot; s&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Elapsed time in microseconds: &quot;</span> </span><br><span class="line">              &lt;&lt; std::chrono::<span class="built_in">duration_cast</span>&lt;std::chrono::microseconds&gt;(duration).<span class="built_in">count</span>() &lt;&lt; <span class="string">&quot; µs&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-单例-只允许一个类实例化一个对象出来-并提供一个全局访问点来获取实例"><a href="#3-2-单例-只允许一个类实例化一个对象出来-并提供一个全局访问点来获取实例" class="headerlink" title="3.2 单例 -&gt; 只允许一个类实例化一个对象出来,并提供一个全局访问点来获取实例"></a>3.2 单例 -&gt; 只允许一个类实例化一个对象出来,并提供一个全局访问点来获取实例</h3><p><strong>如何设计一个单例模式:</strong></p>
<p>① <code>私有化构造函数</code>: 防止在外部;</p>
<p>② <code>禁用拷贝构造函数和赋值运算符</code>:防止在外部通过拷贝构造函数和赋值运算符构造出对象;</p>
<p>③ <code>定义一个静态指针或者引用</code>:用于指向类的唯一实例;</p>
<p>④<code>提供一个静态公有成员函数</code>:返回类的唯一实例的指针或引用,这个函数通常叫做 <code>getInstance()</code> 或者类似的名字</p>
<p>后面的类通过继承 <code>NoCopyable</code> 实现单例:</p>
<blockquote>
<p>NoCopyable.h</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __NOCOPYABLE_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __NOCOPYABLE_H__</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> tmms</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">namespace</span> base</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">NoCopyable</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">protected</span>:</span><br><span class="line">            <span class="built_in">NoCopyable</span>() &#123;&#125;</span><br><span class="line">            ~<span class="built_in">NoCopyable</span>() &#123;&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">NoCopyable</span>(<span class="type">const</span> NoCopyable&amp;) = <span class="keyword">delete</span>; <span class="comment">// 删掉拷贝构造函数</span></span><br><span class="line">            NoCopyable&amp; <span class="keyword">operator</span>=(<span class="type">const</span> NoCopyable&amp;) = <span class="keyword">delete</span>; <span class="comment">// 删除赋值构造函数</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// !__NOCOPYABLE_H__</span></span></span><br></pre></td></tr></table></figure>

<p><strong>单例:</strong></p>
<blockquote>
<p>Singleton.h</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __SINGLETON_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __SINGLETON_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;NoCopyable.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> tmms</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">namespace</span> base</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">SingleTon</span> : <span class="keyword">public</span> NoCopyable </span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">            <span class="built_in">SingleTon</span>() = <span class="keyword">delete</span>;</span><br><span class="line">            ~<span class="built_in">SingleTon</span>() = <span class="keyword">delete</span>; <span class="comment">// 全局变量，程序退出时析构</span></span><br><span class="line">        </span><br><span class="line">            <span class="comment">// 单例</span></span><br><span class="line">            <span class="function"><span class="type">static</span> T*&amp; <span class="title">instance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                <span class="built_in">pthread_once</span>(&amp;ponce_, &amp;SingleTon::init); <span class="comment">// 确保只被初始化一次</span></span><br><span class="line">                <span class="keyword">return</span> value_;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span>:</span><br><span class="line">            <span class="comment">// 初始化函数</span></span><br><span class="line">            <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (!value_)</span><br><span class="line">                &#123;</span><br><span class="line">                    value_ = <span class="keyword">new</span> <span class="built_in">T</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">static</span> <span class="type">pthread_once_t</span> ponce_; <span class="comment">// 控制变量</span></span><br><span class="line">            <span class="type">static</span> T* value_;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">        <span class="type">pthread_once_t</span> SingleTon&lt;T&gt;::ponce_ = PTHREAD_ONCE_INIT;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">        T* SingleTon&lt;T&gt;::value_ = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// !__SINGLETON_H__</span></span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-1-函数简介"><a href="#3-2-1-函数简介" class="headerlink" title="3.2.1 函数简介"></a>3.2.1 函数简介</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">pthread_once</span><span class="params">(<span class="type">pthread_once_t</span> *once_control, <span class="type">void</span> (*init_routine) (<span class="type">void</span>))</span></span>;</span><br><span class="line">	-&gt; 确保给定的初始化函数 init_routine 只会被执行一次</span><br><span class="line">        • 指向一个 <span class="type">pthread_once_t</span> 类型的指针</span><br><span class="line">        • 指向一个返回值为 <span class="type">void</span> 参数为 <span class="type">void</span> 函数,即类型是 <span class="built_in">void</span> (*)(<span class="type">void</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PTHREAD_ONCE_INIT 是一个宏，表示 ponce_ 的初始状态，用于 <span class="built_in">pthread_once</span>() 来确保初始化操作只执行一次。</span><br></pre></td></tr></table></figure>



<h3 id="3-3-定时任务"><a href="#3-3-定时任务" class="headerlink" title="3.3 定时任务"></a>3.3 定时任务</h3><blockquote>
<p>Task.h</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __TASK_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __TASK_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdint&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> tmms</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">namespace</span> base</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">Task</span>;</span><br><span class="line">        <span class="keyword">using</span> TaskPtr = std::shared_ptr&lt;Task&gt;;</span><br><span class="line">        <span class="keyword">using</span> TaskCallBack = std::function&lt;<span class="built_in">void</span> (<span class="type">const</span> TaskPtr&amp;)&gt;;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 定时器任务</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">Task</span> : <span class="keyword">public</span> std::enable_shared_from_this&lt;Task&gt;</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">            <span class="comment">// 定时器任务(param: 回调函数，时间间隔)</span></span><br><span class="line">            <span class="built_in">Task</span>(<span class="type">const</span> TaskCallBack&amp; cb, <span class="type">int64_t</span> interval);</span><br><span class="line">            <span class="built_in">Task</span>(<span class="type">const</span> TaskCallBack&amp;&amp; cb, <span class="type">int64_t</span> interval);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 启动定时器任务</span></span><br><span class="line">            <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">            <span class="comment">// 重启定时器任务</span></span><br><span class="line">            <span class="function"><span class="type">void</span> <span class="title">restart</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取当前的时间点</span></span><br><span class="line">            <span class="function"><span class="type">int64_t</span> <span class="title">when</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span>:</span><br><span class="line">            <span class="type">int64_t</span> interval_ &#123;<span class="number">0</span>&#125;;  <span class="comment">// 时间间隔</span></span><br><span class="line">            <span class="type">int64_t</span> when_ &#123;<span class="number">0</span>&#125;; <span class="comment">// 时间点</span></span><br><span class="line">            TaskCallBack cb_;   <span class="comment">// 回调函数</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// !__TASK_H__</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Task.cpp</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Task.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TTime.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> tmms::base;</span><br><span class="line"></span><br><span class="line">Task::<span class="built_in">Task</span>(<span class="type">const</span> TaskCallBack&amp; cb, <span class="type">int64_t</span> interval) : <span class="built_in">interval_</span>(interval), <span class="built_in">when_</span>(TTime::<span class="built_in">NowMS</span>() + interval), <span class="built_in">cb_</span>(cb)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Task::<span class="built_in">Task</span>(<span class="type">const</span> TaskCallBack&amp;&amp; cb, <span class="type">int64_t</span> interval) : <span class="built_in">interval_</span>(interval), <span class="built_in">when_</span>(TTime::<span class="built_in">NowMS</span>() + interval), <span class="built_in">cb_</span>(std::<span class="built_in">move</span>(cb))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Task::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cb_)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cb_</span>(<span class="built_in">shared_from_this</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Task::restart</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    when_ = interval_ + TTime::<span class="built_in">NowMS</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int64_t</span> <span class="title">Task::when</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> when_;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>int64_t interval_ &#123;0&#125;</code>: 这是 C++11 及以后的初始化方式，也称为<code>统一初始化或列表初始化</code>。它将 interval_ 初始化为 0.</p>
<blockquote>
<p>TaskMgr.h</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __TASKMGR_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __TASKMGR_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Task.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Singleton.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_set&gt;</span> <span class="comment">// Hash</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> tmms</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">namespace</span> base</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 任务管理</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">TaskMgr</span> : <span class="keyword">public</span> NoCopyable</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">            <span class="built_in">TaskMgr</span>() = <span class="keyword">default</span>;</span><br><span class="line">            ~<span class="built_in">TaskMgr</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="type">void</span> <span class="title">onWork</span><span class="params">()</span></span>; <span class="comment">// 定时任务处理</span></span><br><span class="line">            <span class="function"><span class="type">bool</span> <span class="title">add</span><span class="params">(TaskPtr&amp; task)</span></span>; <span class="comment">// 添加任务</span></span><br><span class="line">            <span class="function"><span class="type">bool</span> <span class="title">del</span><span class="params">(TaskPtr&amp; task)</span></span>; <span class="comment">// 删除任务</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span>:</span><br><span class="line">            std::unordered_set&lt;TaskPtr&gt; tasks_; <span class="comment">// 任务队列</span></span><br><span class="line">            std::mutex lock_; <span class="comment">// 锁</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> sTaskMgr tmms::base::SingleTon<span class="string">&lt;tmms::base::TaskMgr&gt;</span>::instance()</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// !__TASKMGR_H__</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>TaskMgr.cpp</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TaskMgr.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TTime.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> tmms::base;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TaskMgr::onWork</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 采用遍历的方式，因为定时器任务较少，效率影响较低</span></span><br><span class="line">    <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lk</span><span class="params">(lock_)</span></span>;</span><br><span class="line">    <span class="type">int64_t</span> now = TTime::<span class="built_in">NowMS</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> iter = tasks_.<span class="built_in">begin</span>(); iter != tasks_.<span class="built_in">end</span>();)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((*iter)-&gt;<span class="built_in">when</span>() &lt; now)</span><br><span class="line">        &#123;</span><br><span class="line">            (*iter)-&gt;<span class="built_in">run</span>();</span><br><span class="line">            <span class="keyword">if</span> ((*iter)-&gt;<span class="built_in">when</span>() &lt; now)</span><br><span class="line">            &#123;</span><br><span class="line">                iter = tasks_.<span class="built_in">erase</span>(iter);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        iter++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">TaskMgr::add</span><span class="params">(TaskPtr&amp; task)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lk</span><span class="params">(lock_)</span></span>; <span class="comment">// 获取锁,声明周期结束会自动释放</span></span><br><span class="line">    <span class="keyword">auto</span> iter = tasks_.<span class="built_in">find</span>(task);</span><br><span class="line">    <span class="keyword">if</span> (iter != tasks_.<span class="built_in">end</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tasks_.<span class="built_in">emplace</span>(task);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">TaskMgr::del</span><span class="params">(TaskPtr&amp; task)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lk</span><span class="params">(lock_)</span></span>;</span><br><span class="line">    tasks_.<span class="built_in">erase</span>(task); <span class="comment">// 有的话直接删除，没有的话不受影响</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-日志库"><a href="#3-4-日志库" class="headerlink" title="3.4 日志库"></a>3.4 日志库</h3><blockquote>
<p>Logger.h</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __LOGGER_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __LOGGER_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;NoCopyable.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;FileLog.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> tmms</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">namespace</span> base</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 日志级别</span></span><br><span class="line">        <span class="keyword">enum</span> <span class="title class_">LogLevel</span></span><br><span class="line">        &#123;</span><br><span class="line">            kTrace,</span><br><span class="line">            kDebug,</span><br><span class="line">            kInfo,              </span><br><span class="line">            kWarn,</span><br><span class="line">            kError,</span><br><span class="line">            kMaxNumOfLogLevel,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 日志类</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">Logger</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">            <span class="built_in">Logger</span>(<span class="type">const</span> FileLogPtr&amp; log);</span><br><span class="line">            ~<span class="built_in">Logger</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置日志级别</span></span><br><span class="line">            <span class="function"><span class="type">void</span> <span class="title">setLogLevel</span><span class="params">(<span class="type">const</span> LogLevel&amp; level)</span></span>;</span><br><span class="line">            <span class="comment">// 获取日志级别</span></span><br><span class="line">            <span class="function">LogLevel <span class="title">getLogLevel</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">            <span class="comment">// 写日志信息</span></span><br><span class="line">            <span class="function"><span class="type">void</span> <span class="title">write</span><span class="params">(<span class="type">const</span> std::string&amp; msg)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span>:</span><br><span class="line">            LogLevel level_ &#123;kDebug&#125;; <span class="comment">// 日志级别</span></span><br><span class="line">            FileLogPtr log_;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// !__LOGGER_H__</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Logger.cpp</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Logger.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> tmms::base;</span><br><span class="line"></span><br><span class="line">Logger::<span class="built_in">Logger</span>(<span class="type">const</span> FileLogPtr&amp; log) : <span class="built_in">log_</span>(log)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Logger::setLogLevel</span><span class="params">(<span class="type">const</span> LogLevel&amp; level)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    level_ = level;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LogLevel <span class="title">Logger::getLogLevel</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> level_;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Logger::write</span><span class="params">(<span class="type">const</span> std::string&amp; msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (log_)</span><br><span class="line">    &#123;</span><br><span class="line">        log_-&gt;<span class="built_in">writeLog</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>FileLog.h</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __FILE_LOG_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __FILE_LOG_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> tmms</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">namespace</span> base</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 日志切分类型</span></span><br><span class="line">        <span class="keyword">enum</span> <span class="title class_">RotateType</span> </span><br><span class="line">        &#123;</span><br><span class="line">            kRorateNone,    <span class="comment">// 不切分</span></span><br><span class="line">            kRotateMinute,  <span class="comment">// 按分钟切分 -&gt; 为了测试</span></span><br><span class="line">            kRotateHour,    <span class="comment">// 按小时切分</span></span><br><span class="line">            kRotateDay,     <span class="comment">// 按天数切分 </span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 日志文件类</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">FileLog</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">            <span class="built_in">FileLog</span>() = <span class="keyword">default</span>;</span><br><span class="line">            ~<span class="built_in">FileLog</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 打开日志文件</span></span><br><span class="line">            <span class="function"><span class="type">bool</span> <span class="title">open</span><span class="params">(<span class="type">const</span> std::string&amp; filePath)</span></span>;</span><br><span class="line">            <span class="comment">// 写日志到文件</span></span><br><span class="line">            <span class="function"><span class="type">ssize_t</span> <span class="title">writeLog</span><span class="params">(<span class="type">const</span> std::string&amp; msg)</span></span>;</span><br><span class="line">            <span class="comment">// 切分</span></span><br><span class="line">            <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">const</span> std::string&amp; file)</span></span>;</span><br><span class="line">            <span class="comment">// 设置切分类型</span></span><br><span class="line">            <span class="function"><span class="type">void</span> <span class="title">setRotate</span><span class="params">(RotateType type)</span></span>;</span><br><span class="line">            <span class="comment">// 获取切分类型</span></span><br><span class="line">            <span class="function">RotateType <span class="title">getRotateType</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">            <span class="comment">// 获取文件长度</span></span><br><span class="line">            <span class="function"><span class="type">int64_t</span> <span class="title">fileSize</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">            <span class="comment">// 获取文件路径</span></span><br><span class="line">            <span class="function">std::string <span class="title">filePath</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span>:</span><br><span class="line">            <span class="type">int</span> fd_; <span class="comment">// 文件描述符</span></span><br><span class="line">            std::string file_path_; <span class="comment">// 文件路径</span></span><br><span class="line">            RotateType rotate_type_&#123;kRorateNone&#125;; <span class="comment">// 切分类型</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> FileLogPtr = std::shared_ptr&lt;FileLog&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// !__FILE_LOG_H__</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>FileLog.cpp</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;FileLog.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> tmms::base;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">FileLog::open</span><span class="params">(<span class="type">const</span> std::string&amp; filePath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    file_path_ = filePath;</span><br><span class="line">    <span class="type">int</span> fd = ::<span class="built_in">open</span>(file_path_.<span class="built_in">c_str</span>(), O_CREAT | O_APPEND | O_RDWR, DEFFILEMODE);</span><br><span class="line">    <span class="keyword">if</span> (fd &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;open file log error! path: &quot;</span> &lt;&lt; filePath &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    fd_ = fd;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">ssize_t</span> <span class="title">FileLog::writeLog</span><span class="params">(<span class="type">const</span> std::string&amp; msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> fd = fd_ == <span class="number">-1</span> ? <span class="number">1</span> : fd_;</span><br><span class="line">    <span class="keyword">return</span> ::<span class="built_in">write</span>(fd_, msg.<span class="built_in">data</span>(), msg.<span class="built_in">size</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FileLog::rotate</span><span class="params">(<span class="type">const</span> std::string&amp; file)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (file_path_.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ret = ::<span class="built_in">rename</span>(file_path_.<span class="built_in">c_str</span>(), file.<span class="built_in">c_str</span>()); <span class="comment">// 保存旧的日志文件</span></span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;rename failed. old: &quot;</span> &lt;&lt; file_path_ &lt;&lt; <span class="string">&quot; new: &quot;</span> &lt;&lt; file;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> fd = ::<span class="built_in">open</span>(file_path_.<span class="built_in">c_str</span>(), O_CREAT | O_APPEND | O_RDWR, DEFFILEMODE);</span><br><span class="line">    <span class="keyword">if</span> (fd &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;open file log error! path: &quot;</span> &lt;&lt; file &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 原子锁 -&gt; write和关闭是有顺序的</span></span><br><span class="line">    ::<span class="built_in">dup2</span>(fd, fd_);</span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FileLog::setRotate</span><span class="params">(RotateType type)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    rotate_type_ = type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">RotateType <span class="title">FileLog::getRotateType</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> rotate_type_;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int64_t</span> <span class="title">FileLog::fileSize</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ::<span class="built_in">lseek64</span>(fd_, <span class="number">0</span>, SEEK_END);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">FileLog::filePath</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> file_path_;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>LogStream.h</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __LOGSTREAM_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __LOGSTREAM_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Logger.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> tmms</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">namespace</span> base</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">extern</span> Logger* g_logger; <span class="comment">// 声明 -&gt; 需要在.cpp中定义</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">LogStream</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">            <span class="built_in">LogStream</span>(Logger* loger, <span class="type">const</span> <span class="type">char</span>* file, <span class="type">int</span> line, LogLevel l, <span class="type">const</span> <span class="type">char</span>* func = <span class="literal">nullptr</span>);</span><br><span class="line">            ~<span class="built_in">LogStream</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">            LogStream&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="type">const</span> T&amp; value)</span><br><span class="line">            &#123;</span><br><span class="line">                stream_ &lt;&lt; value;</span><br><span class="line">                <span class="keyword">return</span> *<span class="keyword">this</span>; <span class="comment">// 确保调用链是完整的</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span>:</span><br><span class="line">            std::ostringstream stream_;</span><br><span class="line">            Logger* logger_ &#123;<span class="literal">nullptr</span>&#125;; </span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOG_TRACE \</span></span><br><span class="line"><span class="meta">    <span class="keyword">if</span> (tmms::base::g_logger-&gt;getLogLevel() &lt;= tmms::base::kTrace) \</span></span><br><span class="line"><span class="meta">        tmms::base::LogStream(tmms::base::g_logger, __FILE__, __LINE__, tmms::base::kTrace, __func__)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOG_DEBUG \</span></span><br><span class="line"><span class="meta">    <span class="keyword">if</span> (tmms::base::g_logger-&gt;getLogLevel() &lt;= tmms::base::kDebug) \</span></span><br><span class="line"><span class="meta">        tmms::base::LogStream(tmms::base::g_logger, __FILE__, __LINE__, tmms::base::kDebug, __func__)</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOG_INFO  \</span></span><br><span class="line"><span class="meta">    <span class="keyword">if</span> (tmms::base::g_logger-&gt;getLogLevel() &lt;= tmms::base::kInfo) \</span></span><br><span class="line"><span class="meta">        tmms::base::LogStream(tmms::base::g_logger, __FILE__, __LINE__, tmms::base::kInfo)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOG_WARN  \</span></span><br><span class="line"><span class="meta">        tmms::base::LogStream(tmms::base::g_logger, __FILE__, __LINE__, tmms::base::kWarn, __func__)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOG_ERROR \</span></span><br><span class="line"><span class="meta">        tmms::base::LogStream(tmms::base::g_logger, __FILE__, __LINE__, tmms::base::kError, __func__)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// !__LOGSTREAM_H__</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>LogStream.cpp</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;LogStream.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TTime.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/syscall.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> tmms::base;</span><br><span class="line"></span><br><span class="line">Logger* tmms::base::g_logger = <span class="literal">nullptr</span>; <span class="comment">// 定义且初始化</span></span><br><span class="line"><span class="type">static</span> <span class="keyword">thread_local</span> <span class="type">pid_t</span> thread_id = <span class="number">0</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* log_string[] = </span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot; TRACE &quot;</span>,</span><br><span class="line">    <span class="string">&quot; DEBUG &quot;</span>,</span><br><span class="line">    <span class="string">&quot; INFO &quot;</span>, </span><br><span class="line">    <span class="string">&quot; WARN &quot;</span>,</span><br><span class="line">    <span class="string">&quot; ERROR&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">LogStream::<span class="built_in">LogStream</span>(Logger* loger, <span class="type">const</span> <span class="type">char</span>* file, <span class="type">int</span> line, LogLevel l, <span class="type">const</span> <span class="type">char</span>* func) : <span class="built_in">logger_</span>(loger)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* file_name = <span class="built_in">strrchr</span>(file, <span class="string">&#x27;/&#x27;</span>); <span class="comment">// 查找 /</span></span><br><span class="line">    <span class="keyword">if</span> (file_name)</span><br><span class="line">    &#123;</span><br><span class="line">        file_name = file_name + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        file_name = file;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stream_ &lt;&lt; TTime::<span class="built_in">ISOTime</span>() &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (thread_id == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        thread_id = <span class="built_in">static_cast</span>&lt;<span class="type">pid_t</span>&gt;(::<span class="built_in">syscall</span>(SYS_gettid));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stream_ &lt;&lt; thread_id;</span><br><span class="line">    stream_ &lt;&lt; log_string[l];</span><br><span class="line">    stream_ &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; file_name &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; line &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (func)</span><br><span class="line">    &#123;</span><br><span class="line">        stream_ &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; func &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LogStream::~<span class="built_in">LogStream</span>()</span><br><span class="line">&#123;</span><br><span class="line">    stream_ &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    logger_-&gt;<span class="built_in">write</span>(stream_.<span class="built_in">str</span>()); <span class="comment">// 写到日志</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</article>
    
    <div class="trm-reward">
        
            <span class="trm-reward-btn trm-glow" onclick='var qr = document.getElementById("qr"); qr.style.display = (qr.style.display === "none") ? "block" : "none";'>
                <i class="iconfont fas fa-hand-holding-usd"></i>
            </span>
        
        <p class="trm-reward-comment">sponsor</p>
        <div id="qr" style="display:none;">
            
                <div style="display:inline-block">
                    <a rel="noopener noreferrer" href='/img/wechat.jpg' target='_blank' >
                       <img src="/img/wechat.jpg" alt="微信" loading="lazy">
                    </a>
                    <p>微信</p>
                </div>
            
                <div style="display:inline-block">
                    <a rel="noopener noreferrer" href='/img/zhifubao.jpg' target='_blank' >
                       <img src="/img/zhifubao.jpg" alt="支付宝" loading="lazy">
                    </a>
                    <p>支付宝</p>
                </div>
            
        </div>
    </div>

    

</div>
<div class="trm-post-next-prev row">
    <div class="col-lg-12">
        <!-- title -->
        <h5 class="trm-title-with-divider">
            Other Articles
            <span data-number="02"></span>
        </h5>
    </div>
    
        <div class="col-lg-6">
    <div class="trm-blog-card trm-scroll-animation">
        <a href="/2024/11/26/GDB%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/" class="trm-cover-frame trm-anima-link">
            
            
                <img alt="cover" class="no-fancybox" src="/img/block.jpg">
            
        </a>
        
        <div class="trm-card-descr">
            <div class="trm-label trm-category trm-mb-20">
                <a href=" /categories/C/">
                    C++
                </a>
            </div>
            <h5>
                <a href="/2024/11/26/GDB%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/" class="trm-anima-link">
                    GDB调试技巧
                </a>
            </h5>
            <div class="trm-divider trm-mb-20 trm-mt-20"></div>
            <ul class="trm-card-data trm-label">
                <li>24/11/26</li>
                <li>09:44</li>
                
                
            </ul>
        </div>
    </div>
</div>
    
    
        <div class="col-lg-6">
    <div class="trm-blog-card trm-scroll-animation">
        <a href="/2024/11/06/SpringBoot%20+%20Vue%20%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="trm-cover-frame trm-anima-link">
            
            
                <img alt="cover" class="no-fancybox" src="/img/block.jpg">
            
        </a>
        
        <div class="trm-card-descr">
            <div class="trm-label trm-category trm-mb-20">
                <a href=" /categories/Java/">
                    Java
                </a>
            </div>
            <h5>
                <a href="/2024/11/06/SpringBoot%20+%20Vue%20%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="trm-anima-link">
                    SpringBoot + Vue 项目部署到服务器
                </a>
            </h5>
            <div class="trm-divider trm-mb-20 trm-mt-20"></div>
            <ul class="trm-card-data trm-label">
                <li>24/11/06</li>
                <li>18:31</li>
                
                
            </ul>
        </div>
    </div>
</div>
    
</div>

    



                    <div class="trm-divider footer-divider"></div>

                    <!-- footer -->
                    <footer class="trm-footer-card trm-scroll-animation">

    

    

    
        <div class="trm-footer-item">
            <span>
                Powered by <a href="https://github.com/jarryLi-max" target="_blank" rel="noopener">JarryLi</a> 
                <!-- v7.3.0 -->
            </span>
            <!-- <span class="footer-separator" data-separator=" | "></span>
            <span> 
                Theme - 
                <a rel="noopener" href='https://github.com/MaLuns/hexo-theme-async' target='_blank'>Async</a>
                v2.2.2
            </span> -->
        </div>
      

    
        <div class="trm-footer-item blog-run-long"></div>
     

     
</footer>
                    <!-- footer end -->

                </div>
            </div>
        </div>
    </div>
</div>
            <!-- body end -->

            

    <div id="post-toc" class="trm-post-toc">
      <div class="trm-post-toc-header">
        Article table of contents
				<span id="post-toc-top">
					TOP
				</span>
      </div>
      <div class="trm-post-toc-content">
        <ol class="trm-toc"><li class="trm-toc-item trm-toc-level-1" title="C++大型流媒体项目"><a rel="nofollow" class="trm-toc-link" href="#C-大型流媒体项目"><span class="trm-toc-number">1.</span> <span class="trm-toc-text">C++大型流媒体项目</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="1. 安装配置Centos7"><a rel="nofollow" class="trm-toc-link" href="#1-安装配置Centos7"><span class="trm-toc-number">1.1.</span> <span class="trm-toc-text">1. 安装配置Centos7</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="1.1 下载镜像虚拟机安装系统"><a rel="nofollow" class="trm-toc-link" href="#1-1-下载镜像虚拟机安装系统"><span class="trm-toc-number">1.1.1.</span> <span class="trm-toc-text">1.1 下载镜像虚拟机安装系统</span></a></li><li class="trm-toc-item trm-toc-level-3" title="1.2 更改yum源"><a rel="nofollow" class="trm-toc-link" href="#1-2-更改yum源"><span class="trm-toc-number">1.1.2.</span> <span class="trm-toc-text">1.2 更改yum源</span></a></li><li class="trm-toc-item trm-toc-level-3" title="1.3 安装必要环境"><a rel="nofollow" class="trm-toc-link" href="#1-3-安装必要环境"><span class="trm-toc-number">1.1.3.</span> <span class="trm-toc-text">1.3 安装必要环境</span></a></li><li class="trm-toc-item trm-toc-level-3" title="1.4 VSCode远程通过SSH连接Linux"><a rel="nofollow" class="trm-toc-link" href="#1-4-VSCode远程通过SSH连接Linux"><span class="trm-toc-number">1.1.4.</span> <span class="trm-toc-text">1.4 VSCode远程通过SSH连接Linux</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="2. 创建工程项目文件夹"><a rel="nofollow" class="trm-toc-link" href="#2-创建工程项目文件夹"><span class="trm-toc-number">1.2.</span> <span class="trm-toc-text">2. 创建工程项目文件夹</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="2.1 创建tmms文件夹"><a rel="nofollow" class="trm-toc-link" href="#2-1-创建tmms文件夹"><span class="trm-toc-number">1.2.1.</span> <span class="trm-toc-text">2.1 创建tmms文件夹</span></a></li><li class="trm-toc-item trm-toc-level-3" title="2.2 依次创建下列文件夹和文件"><a rel="nofollow" class="trm-toc-link" href="#2-2-依次创建下列文件夹和文件"><span class="trm-toc-number">1.2.2.</span> <span class="trm-toc-text">2.2 依次创建下列文件夹和文件</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="3.  C++通用基础函数库实现"><a rel="nofollow" class="trm-toc-link" href="#3-C-通用基础函数库实现"><span class="trm-toc-number">1.3.</span> <span class="trm-toc-text">3.  C++通用基础函数库实现</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="3.1 时间常用函数"><a rel="nofollow" class="trm-toc-link" href="#3-1-时间常用函数"><span class="trm-toc-number">1.3.1.</span> <span class="trm-toc-text">3.1 时间常用函数</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-4" title="3.1.1 函数简介"><a rel="nofollow" class="trm-toc-link" href="#3-1-1-函数简介"><span class="trm-toc-number">1.3.1.1.</span> <span class="trm-toc-text">3.1.1 函数简介</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-3" title="std::chrono 中的常用组件"><a rel="nofollow" class="trm-toc-link" href="#std-chrono-中的常用组件"><span class="trm-toc-number">1.3.2.</span> <span class="trm-toc-text">std::chrono 中的常用组件</span></a></li><li class="trm-toc-item trm-toc-level-3" title="3.2 单例 -&gt; 只允许一个类实例化一个对象出来,并提供一个全局访问点来获取实例"><a rel="nofollow" class="trm-toc-link" href="#3-2-单例-只允许一个类实例化一个对象出来-并提供一个全局访问点来获取实例"><span class="trm-toc-number">1.3.3.</span> <span class="trm-toc-text">3.2 单例 -&gt; 只允许一个类实例化一个对象出来,并提供一个全局访问点来获取实例</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-4" title="3.2.1 函数简介"><a rel="nofollow" class="trm-toc-link" href="#3-2-1-函数简介"><span class="trm-toc-number">1.3.3.1.</span> <span class="trm-toc-text">3.2.1 函数简介</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-3" title="3.3 定时任务"><a rel="nofollow" class="trm-toc-link" href="#3-3-定时任务"><span class="trm-toc-number">1.3.4.</span> <span class="trm-toc-text">3.3 定时任务</span></a></li><li class="trm-toc-item trm-toc-level-3" title="3.4 日志库"><a rel="nofollow" class="trm-toc-link" href="#3-4-日志库"><span class="trm-toc-number">1.3.5.</span> <span class="trm-toc-text">3.4 日志库</span></a></li></ol></li></ol></li></ol>
      </div>
    </div>

            
<div class="trm-fixed-container">
    
        <div class="trm-fixed-btn post-toc-btn" data-title="Open toc">
            <i class="iconfont fas fa-th-list"></i>
        </div>
    
    
        <div class="trm-fixed-btn" data-title="Read Mode" onclick="asyncFun.switchReadMode()">
            <i class="iconfont fas fa-book-reader"></i>
        </div>
    
    
    <div id="trm-back-top" class="trm-fixed-btn" data-title="Back To Top">
        <i class="iconfont fas fa-arrow-up"></i>
    </div>
</div>
        </div>
      </div>
      <!-- scroll container end -->
  </div>
  <!-- app wrapper end -->

  
    <div class="trm-search-popup">
        <div class="trm-search-wrapper">
            <div class="form trm-search-form">
                <div class="trm-search-input-icon">
                    <i class="iconfont fas fa-search"></i>
                </div>
                <input class="trm-search-input" type="text" placeholder="Searching...">
                <div class="trm-search-btn-close">
                    <i class="iconfont fas fa-times"></i>
                </div>
            </div>
            <div class="trm-search-result-container">
                <div class="trm-search-empty">
                    Please enter keywords to search
                </div>
            </div>
            <div class="trm-search-footer">
                <div class="trm-search-stats"></div>
                <ul class="trm-search-commands">
                    <li>
                        <kbd class="command-palette-commands-key">
                            <svg width="15" height="15" aria-label="Escape key" role="img">
                                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="1.2">
                                    <path
                                        d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993 0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016.8634 0 1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5c.032.5663-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864 0 1.6425 1.031 1.5443 2.2492h-2.956">
                                    </path>
                                </g>
                            </svg>
                        </kbd>
                        <span class="command-palette-Label">to close</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

  <!-- Plugin -->




    
    
<script src="https://unpkg.com/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>

    

    

    
        
<script src="https://unpkg.com/hexo-generator-searchdb@1.4.0/dist/search.js"></script>

        <script src="/js/plugins/local_search.js?v=2.2.2"></script>
    

    <!-- 数学公式 -->
    

    <!-- 评论插件 -->
    
        

        
    

		




    <!-- Service Worker -->
    
    <!-- baidu push -->
    


<script id="async-script" src="/js/main.js?v=2.2.2"></script>

<!-- CDN -->


    

    

    



</body>

</html>